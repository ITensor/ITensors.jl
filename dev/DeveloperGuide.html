<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Developer Guide · ITensors.jl</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script><link href="assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img src="assets/logo.png" alt="ITensors.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">ITensors.jl</a></span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li><span class="tocitem">Getting Started with ITensor</span><ul><li><a class="tocitem" href="getting_started/Installing.html">Installing Julia and ITensor</a></li><li><a class="tocitem" href="getting_started/RunningCodes.html">Running ITensor and Julia Codes</a></li><li><a class="tocitem" href="getting_started/DebugChecks.html">Enabling Debug Checks</a></li><li><a class="tocitem" href="getting_started/NextSteps.html">Next Steps</a></li></ul></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="tutorials/DMRG.html">DMRG</a></li><li><a class="tocitem" href="tutorials/QN_DMRG.html">Quantum Number Conserving DMRG</a></li><li><a class="tocitem" href="tutorials/MPSTimeEvolution.html">MPS Time Evolution</a></li></ul></li><li><span class="tocitem">Code Examples</span><ul><li><a class="tocitem" href="examples/ITensor.html">ITensor Examples</a></li><li><a class="tocitem" href="examples/MPSandMPO.html">MPS and MPO Examples</a></li><li><a class="tocitem" href="examples/DMRG.html">DMRG Examples</a></li><li><a class="tocitem" href="examples/Physics.html">Physics (SiteType) System Examples</a></li></ul></li><li><span class="tocitem">Documentation</span><ul><li><a class="tocitem" href="IndexType.html">Index</a></li><li><a class="tocitem" href="IndexSetType.html">Index collections</a></li><li><a class="tocitem" href="ITensorType.html">ITensor</a></li><li><a class="tocitem" href="MPSandMPO.html">MPS and MPO</a></li><li><a class="tocitem" href="QN.html">QN</a></li><li><a class="tocitem" href="SiteType.html">SiteType and op, state, val functions</a></li><li><a class="tocitem" href="IncludedSiteTypes.html">SiteTypes Included with ITensor</a></li><li><input class="collapse-toggle" id="menuitem-5-8" type="checkbox"/><label class="tocitem" for="menuitem-5-8"><span class="docs-label">DMRG</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="DMRG.html">DMRG</a></li><li><a class="tocitem" href="Sweeps.html">Sweeps</a></li><li><a class="tocitem" href="ProjMPO.html">ProjMPO</a></li><li><a class="tocitem" href="ProjMPOSum.html">ProjMPOSum</a></li><li><a class="tocitem" href="Observer.html">Observer System for DMRG</a></li><li><a class="tocitem" href="DMRGObserver.html">DMRGObserver</a></li></ul></li><li><a class="tocitem" href="OpSum.html">OpSum (AutoMPO)</a></li></ul></li><li><span class="tocitem">Frequently Asked Questions</span><ul><li><a class="tocitem" href="faq/JuliaAndCpp.html">Programming Language (Julia, C++, ...) FAQs</a></li><li><a class="tocitem" href="faq/DMRG.html">DMRG FAQs</a></li><li><a class="tocitem" href="faq/QN.html">Quantum Number (QN) FAQs</a></li><li><a class="tocitem" href="faq/Development.html">ITensor Development FAQs</a></li><li><a class="tocitem" href="faq/RelationshipToOtherLibraries.html">Relationship of ITensor to other tensor libraries FAQs</a></li><li><a class="tocitem" href="faq/JuliaPkg.html">Julia Package Manager FAQs</a></li><li><a class="tocitem" href="faq/HPC.html">High-Performance Computing FAQs</a></li></ul></li><li><span class="tocitem">Upgrade guides</span><ul><li><a class="tocitem" href="UpgradeGuide_0.1_to_0.2.html">Upgrading from 0.1 to 0.2</a></li></ul></li><li><a class="tocitem" href="Einsum.html">ITensor indices and Einstein notation</a></li><li><span class="tocitem">Advanced Usage Guide</span><ul><li><a class="tocitem" href="AdvancedUsageGuide.html">Advanced Usage Guide</a></li><li><a class="tocitem" href="Multithreading.html">Multithreading</a></li><li><a class="tocitem" href="RunningOnGPUs.html">Running on GPUs</a></li><li><a class="tocitem" href="QNTricks.html">Symmetric (QN conserving) tensors: background and usage</a></li><li><a class="tocitem" href="CodeTiming.html">Timing and profiling</a></li><li><a class="tocitem" href="ContractionSequenceOptimization.html">Contraction sequence optimization</a></li><li><a class="tocitem" href="HDF5FileFormats.html">HDF5 File Formats</a></li></ul></li><li class="is-active"><a class="tocitem" href="DeveloperGuide.html">Developer Guide</a><ul class="internal"><li><a class="tocitem" href="#Keyword-Argument-Best-Practices"><span>Keyword Argument Best Practices</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="DeveloperGuide.html">Developer Guide</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="DeveloperGuide.html">Developer Guide</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ITensor/ITensors.jl/blob/main/docs/src/DeveloperGuide.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Developer-Guide"><a class="docs-heading-anchor" href="#Developer-Guide">Developer Guide</a><a id="Developer-Guide-1"></a><a class="docs-heading-anchor-permalink" href="#Developer-Guide" title="Permalink"></a></h1><h2 id="Keyword-Argument-Best-Practices"><a class="docs-heading-anchor" href="#Keyword-Argument-Best-Practices">Keyword Argument Best Practices</a><a id="Keyword-Argument-Best-Practices-1"></a><a class="docs-heading-anchor-permalink" href="#Keyword-Argument-Best-Practices" title="Permalink"></a></h2><p>Keyword arguments such as <code>f(x,y; a=1, b=2)</code> are a powerful Julia feature, but it is easy to misuse them in library code. Below are the &quot;best practices&quot; for using keyword arguments when developing ITensor library code.</p><p>A particular challenge how to properly use keyword argument &quot;forwarding&quot; where the notation <code>f(; a, b, kwargs...)</code> allows any number of keyword arguments to be passed. If a keyword argument is misspelled, then forwarding keywords with <code>kwargs...</code> will silently allow the misspelling, whereas ideally there would be an error message.</p><p>Best practices:</p><ol><li><p><strong>Popping Terminal Keyword Arguments</strong>: When passing keyword arguments downward through a stack of function calls, if a certain keyword argument will not be used in any functions further down the stack, then these arguments should be <em>listed explicitly</em> to remove them from the keyword arguments.</p><p>For example, in a call stack <code>fA -&gt; fB -&gt; fC</code> if a keyword argument such as <code>cutoff</code> is used in the body of <code>fB</code> but not in <code>fC</code>, then use the following pattern:</p><pre><code class="nohighlight hljs">function fA(...; kwargs...)
   ...
   fB(...; kwargs...)
   ...
end

function fB(...; cutoff, kwargs...) # &lt;- explicitly list cutoff here
   ...
   truncate!(psi; cutoff) # &lt;- fB uses cutoff
   fC(...; kwargs...) # fC does not get passed cutoff
end

function fC(...; maxdim, outputlevel) # fC does not use or need the `cutoff` kwarg
  ...
end</code></pre></li><li><p><strong>Leaf Functions Should Not Take <code>kwargs...</code></strong>: Functions which are the last in the call stack to take any keyword arguments should not take keyword arguments by the <code>kwargs...</code> pattern. They should only take an explicit list of keyword arguments, so as to ensure that an error is thrown if a keyword argument is misspelled or missing (if it has no default value).</p><p>Example: <code>fC</code> above is a leaf function and does not have <code>kwargs...</code> in its signature.</p></li><li><p><strong>Use Functions to Set Defaults</strong>: Keyword arguments can be made optional by providing default values. To avoid having explicit and possibly inconsistent defaults spread all over the library code, use globally defined functions to provide these defaults.</p><p>For example:</p><pre><code class="nohighlight hljs">function sum(A::MPS, B::MPS; cutoff=default_cutoff(), kwargs...)
...
end

function inner(A::MPS, B::MPS; cutoff=default_cutoff(), kwargs...)
...
end</code></pre><p>where above the default value for the <code>cutoff</code> keyword is provided by a function <code>default_cutoff()</code> that is defined for the whole library.</p></li><li><p><strong>Use Named Tuples to &quot;Tunnel&quot; Keywords to Leaf Functions</strong>: This is a more advanced pattern. In certain situations, there might be multiple leaf functions depending on the execution pathway of the code or in cases where the leaf function is a &quot;callback&quot; passed into the code from the upper-level calling code.</p><p>In such cases, different leaf function implementations may expect different sets of keyword arguments.</p><p>To avoid requiring all leaf functions to take all possible keyword arguments (or to use the <code>kwargs...</code> pattern as a workaround, breaking rule #2 above), use the following pattern:</p><pre><code class="nohighlight hljs">function fA(callback, psi; callback_args, kwargs...)
  ...
  callback(psi; callback_args...)
  ...
end

my_callback(psi; a, b) = ...  # define custom callback function

# Call fA like this:
fA(my_callback, psi; callback_args = (; a, b))
</code></pre></li><li><p><strong>External (non-ITensor) Functions</strong>: Though it requires judgment in each case, if the keyword arguments an external (non-ITensor) function accepts are small in number, not expected to change, and known ahead of time, try to list them explicitly if possible (rather than forwarding with <code>kwargs...</code>). Possible exceptions could be if you want to make use of defaults defined for keyword arguments of an external function.</p></li></ol></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="HDF5FileFormats.html">« HDF5 File Formats</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Sunday 5 May 2024 21:00">Sunday 5 May 2024</span>. Using Julia version 1.10.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
