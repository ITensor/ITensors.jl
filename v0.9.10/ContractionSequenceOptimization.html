<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Contraction sequence optimization · ITensors.jl</title><meta name="title" content="Contraction sequence optimization · ITensors.jl"/><meta property="og:title" content="Contraction sequence optimization · ITensors.jl"/><meta property="twitter:title" content="Contraction sequence optimization · ITensors.jl"/><meta name="description" content="Documentation for ITensors.jl."/><meta property="og:description" content="Documentation for ITensors.jl."/><meta property="twitter:description" content="Documentation for ITensors.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script><link href="assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="assets/extras.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img class="docs-light-only" src="assets/logo.png" alt="ITensors.jl logo"/><img class="docs-dark-only" src="assets/logo-dark.png" alt="ITensors.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">ITensors.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li><span class="tocitem">Getting Started with ITensor</span><ul><li><a class="tocitem" href="getting_started/Installing.html">Installing Julia and ITensor</a></li><li><a class="tocitem" href="getting_started/RunningCodes.html">Running ITensor and Julia Codes</a></li><li><a class="tocitem" href="getting_started/DebugChecks.html">Enabling Debug Checks</a></li><li><a class="tocitem" href="getting_started/NextSteps.html">Next Steps</a></li></ul></li><li><span class="tocitem">Code Examples</span><ul><li><a class="tocitem" href="examples/ITensor.html">ITensor Examples</a></li></ul></li><li><span class="tocitem">Documentation</span><ul><li><a class="tocitem" href="IndexType.html">Index</a></li><li><a class="tocitem" href="ITensorType.html">ITensor</a></li><li><a class="tocitem" href="QN.html">QN</a></li></ul></li><li><span class="tocitem">Frequently Asked Questions</span><ul><li><a class="tocitem" href="faq/Development.html">ITensor Development FAQs</a></li><li><a class="tocitem" href="faq/JuliaPkg.html">Julia Package Manager FAQs</a></li></ul></li><li><span class="tocitem">Upgrade guides</span><ul><li><a class="tocitem" href="UpgradeGuide_0.1_to_0.2.html">Upgrading from 0.1 to 0.2</a></li></ul></li><li><span class="tocitem">Advanced Usage Guide</span><ul><li><a class="tocitem" href="Multithreading.html">Multithreading</a></li><li><a class="tocitem" href="RunningOnGPUs.html">Running on GPUs</a></li><li class="is-active"><a class="tocitem" href="ContractionSequenceOptimization.html">Contraction sequence optimization</a><ul class="internal"><li><a class="tocitem" href="#Functions"><span>Functions</span></a></li><li><a class="tocitem" href="#Examples"><span>Examples</span></a></li></ul></li><li><a class="tocitem" href="HDF5FileFormats.html">HDF5 File Formats</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Advanced Usage Guide</a></li><li class="is-active"><a href="ContractionSequenceOptimization.html">Contraction sequence optimization</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="ContractionSequenceOptimization.html">Contraction sequence optimization</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ITensor/ITensors.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ITensor/ITensors.jl/blob/main/docs/src/ContractionSequenceOptimization.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Contraction-sequence-optimization"><a class="docs-heading-anchor" href="#Contraction-sequence-optimization">Contraction sequence optimization</a><a id="Contraction-sequence-optimization-1"></a><a class="docs-heading-anchor-permalink" href="#Contraction-sequence-optimization" title="Permalink"></a></h1><p>When contracting a tensor network, the sequence of contraction makes a big difference in the computational cost. However, the complexity of determining the optimal sequence grows exponentially with the number of tensors, but there are many heuristic algorithms available for computing optimal sequences for small networks<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup><sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup><sup class="footnote-reference"><a id="citeref-3" href="#footnote-3">[3]</a></sup><sup class="footnote-reference"><a id="citeref-4" href="#footnote-4">[4]</a></sup><sup class="footnote-reference"><a id="citeref-5" href="#footnote-5">[5]</a></sup><sup class="footnote-reference"><a id="citeref-6" href="#footnote-6">[6]</a></sup>. ITensors.jl imports functionality from <a href="https://github.com/Jutho/TensorOperations.jl">TensorOperations.jl</a> for helping you find the optimal contraction sequence for small tensor network, as we will show below.</p><h2 id="Functions"><a class="docs-heading-anchor" href="#Functions">Functions</a><a id="Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Functions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ITensors.optimal_contraction_sequence" href="#ITensors.optimal_contraction_sequence"><code>ITensors.optimal_contraction_sequence</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">optimal_contraction_sequence(T)</code></pre><p>Returns a contraction sequence for contracting the tensors <code>T</code>. The sequence is generally optimal and is found via the optimaltree function in TensorOperations.jl which must be loaded.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ITensor/ITensors.jl/blob/885175c7c1b669e77a47244ade14fff69b4a8e14/src/tensor_operations/tensor_algebra.jl#L133-L138">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ITensors.contraction_cost" href="#ITensors.contraction_cost"><code>ITensors.contraction_cost</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">contraction_cost(A; sequence)</code></pre><p>Return the cost of contracting the collection of ITensors according to the specified sequence, where the cost is measured in the number of floating point operations that would need to be performed to contract dense tensors of the dimensions specified by the indices of the tensors (so for now, sparsity is ignored in computing the costs). Pairwise costs are returned in a vector (contracting <code>N</code> tensors requires <code>N-1</code> pairwise contractions). You can use <code>sum(contraction_cost(A; sequence))</code> to get the total cost of the contraction.</p><p>If no sequence is specified, left associative contraction is used, in other words the sequence is equivalent to <code>[[[[1, 2], 3], 4], …]</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ITensor/ITensors.jl/blob/885175c7c1b669e77a47244ade14fff69b4a8e14/src/tensor_operations/contraction_cost.jl#L5-L18">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="NDTensors.contract" href="#NDTensors.contract"><code>NDTensors.contract</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">*(As::ITensor...; sequence = default_sequence(), kwargs...)
*(As::Vector{&lt;: ITensor}; sequence = default_sequence(), kwargs...)
contract(As::ITensor...; sequence = default_sequence(), kwargs...)</code></pre><p>Contract the set of ITensors according to the contraction sequence.</p><p>The default sequence is &quot;automatic&quot; if <code>ITensors.using_contraction_sequence_optimization()</code> is true, otherwise it is &quot;left_associative&quot; (the ITensors are contracted from left to right).</p><p>You can change the default with <code>ITensors.enable_contraction_sequence_optimization()</code> and <code>ITensors.disable_contraction_sequence_optimization()</code>.</p><p>For a custom sequence, the sequence should be provided as a binary tree where the leaves are integers <code>n</code> specifying the ITensor <code>As[n]</code> and branches are accessed by indexing with <code>1</code> or <code>2</code>, i.e. <code>sequence = Any[Any[1, 3], Any[2, 4]]</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ITensor/ITensors.jl/blob/885175c7c1b669e77a47244ade14fff69b4a8e14/src/tensor_operations/tensor_algebra.jl#L87-L103">source</a></section></article><h2 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h2><p>In the following example we show how to compute the contraction sequence cost of a</p><pre><code class="language- hljs">using ITensors
using Symbolics

using ITensors: contraction_cost

@variables m, k, d

l = Index(m, &quot;l&quot;)
r = Index(m, &quot;r&quot;)
h₁ = Index(k, &quot;h₁&quot;)
h₂ = Index(k, &quot;h₂&quot;)
h₃ = Index(k, &quot;h₃&quot;)
s₁ = Index(d, &quot;s₁&quot;)
s₂ = Index(d, &quot;s₂&quot;)

H₁ = ITensor(dag(s₁), s₁&#39;, dag(h₁), h₂)
H₂ = ITensor(dag(s₂), s₂&#39;, dag(h₂), h₃)
L = ITensor(dag(l), l&#39;, h₁)
R = ITensor(dag(r), r&#39;, h₃)
ψ = ITensor(l, s₁, s₂, r)

TN = [ψ, L, H₁, H₂, R]
sequence1 = Any[2, Any[3, Any[4, Any[1, 5]]]]
sequence2 = Any[Any[4, 5], Any[1, Any[2, 3]]]
cost1 = contraction_cost(TN; sequence = sequence1)
cost2 = contraction_cost(TN; sequence = sequence2)

println(&quot;First sequence&quot;)
display(sequence1)
display(cost1)
@show sum(cost1)
@show substitute(sum(cost1), Dict(d =&gt; 4))

println(&quot;\nSecond sequence&quot;)
display(sequence2)
display(cost2)
@show sum(cost2)
@show substitute(sum(cost2), Dict(d =&gt; 4))</code></pre><p>This example helps us learn that in the limit of large MPS bond dimension <code>m</code>, the first contraction sequence is faster, while in the limit of large MPO bond dimension <code>k</code>, the second sequence is faster. This has practical implications for writing an efficient DMRG algorithm in both limits, which we plan to incorporate into ITensors.jl.</p><p>Here is a more systematic example of searching through the parameter space to find optimal contraction sequences. Note, the TensorOperations.jl library must be loaded to use the optimal<em>contraction</em>sequence function:</p><pre><code class="language-julia hljs">using ITensors
using Symbolics

using ITensors: contraction_cost, optimal_contraction_sequence
using TensorOperations: TensorOperations

function tensor_network(; m, k, d)
  l = Index(m, &quot;l&quot;)
  r = Index(m, &quot;r&quot;)
  h₁ = Index(k, &quot;h₁&quot;)
  h₂ = Index(k, &quot;h₂&quot;)
  h₃ = Index(k, &quot;h₃&quot;)
  s₁ = Index(d, &quot;s₁&quot;)
  s₂ = Index(d, &quot;s₂&quot;)

  ψ = ITensor(l, s₁, s₂, r)
  L = ITensor(dag(l), l&#39;, h₁)
  H₁ = ITensor(dag(s₁), s₁&#39;, dag(h₁), h₂)
  H₂ = ITensor(dag(s₂), s₂&#39;, dag(h₂), h₃)
  R = ITensor(dag(r), r&#39;, h₃)
  return [ψ, L, H₁, H₂, R]
end

function main()
  mrange = 50:10:80
  krange = 50:10:80
  sequence_costs = Matrix{Any}(undef, length(mrange), length(krange))
  for iₘ in eachindex(mrange), iₖ in eachindex(krange)
    m_val = mrange[iₘ]
    k_val = krange[iₖ]
    d_val = 4

    TN = tensor_network(; m = m_val, k = k_val, d = d_val)
    sequence = optimal_contraction_sequence(TN)
    cost = contraction_cost(TN; sequence = sequence)

    @variables m, k, d
    TN_symbolic = tensor_network(; m = m, k = k, d = d)
    cost_symbolic = contraction_cost(TN_symbolic; sequence = sequence)
    sequence_cost = (dims = (m = m_val, k = k_val, d = d_val), sequence = sequence, cost = cost, symbolic_cost = cost_symbolic)
    sequence_costs[iₘ, iₖ] = sequence_cost
  end
  return sequence_costs
end

sequence_costs = main()

# Analyze the results.
println(&quot;Index dimensions&quot;)
display(getindex.(sequence_costs, :dims))

println(&quot;\nContraction sequences&quot;)
display(getindex.(sequence_costs, :sequence))

println(&quot;\nSymbolic contraction cost with d = 4&quot;)
# Fix d to a certain value (such as 4 for a Hubbard site)
@variables d
var_sub = Dict(d =&gt; 4)
display(substitute.(sum.(getindex.(sequence_costs, :symbolic_cost)), (var_sub,)))</code></pre><p>A future direction will be to allow optimizing over contraction sequences with the dimensions specified symbolically, so that the optimal sequence in limits of certain dimensions can be found. In addition, we plan to implement more algorithms that work for larger networks, as well as algorithms like<sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup> which take an optimal sequence for a closed network and generate optimal sequences for environments of each tensor in the network, which is helpful for computing gradients of tensor networks.</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a><a href="https://arxiv.org/abs/1304.6112">Faster identification of optimal contraction sequences for tensor networks</a></li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a><a href="https://arxiv.org/abs/1310.8023">Improving the efficiency of variational tensor network algorithms</a></li><li class="footnote" id="footnote-3"><a class="tag is-link" href="#citeref-3">3</a><a href="https://arxiv.org/abs/quant-ph/0511069">Simulating quantum computation by contracting tensor networks</a></li><li class="footnote" id="footnote-4"><a class="tag is-link" href="#citeref-4">4</a><a href="https://journals.aps.org/pre/abstract/10.1103/PhysRevE.100.043309">Towards a polynomial algorithm for optimal contraction sequence of tensor networks from trees</a></li><li class="footnote" id="footnote-5"><a class="tag is-link" href="#citeref-5">5</a><a href="https://arxiv.org/abs/2001.08063">Algorithms for Tensor Network Contraction Ordering</a></li><li class="footnote" id="footnote-6"><a class="tag is-link" href="#citeref-6">6</a><a href="https://arxiv.org/abs/2002.01935">Hyper-optimized tensor network contraction</a></li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="RunningOnGPUs.html">« Running on GPUs</a><a class="docs-footer-nextpage" href="HDF5FileFormats.html">HDF5 File Formats »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Thursday 11 September 2025 18:53">Thursday 11 September 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
